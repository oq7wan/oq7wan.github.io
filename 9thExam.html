<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>امتحان مستوى</title>
  <style>
    body {
      font-family: "Tajawal", sans-serif;
      direction: rtl;
      text-align: center;
    }
    section { display: none; }
    section.active { display: block; }
    .question { margin: 15px 0; }
  </style>
</head>
<body>

  <!-- Section 1: Student Info -->
  <section id="infoSection" class="active">
    <h2>معلومات الطالب</h2>
    <form id="studentForm">
      <label>الاسم:</label>
      <input type="text" name="name" required><br><br>
      <label>الصف:</label>
      <input type="text" name="grade" required><br><br>
      <label>المدرسة:</label>
      <input type="text" name="school" required><br><br>
      <button type="submit">ابدأ الاختبار</button>
    </form>
  </section>

  <!-- Section 2: Exam -->
  <section id="examSection">
    <h2>الامتحان</h2>

    <div class="question">
      <p>1. ما هي وحدة بناء الجسم؟</p>
      <label><input type="radio" name="q1" value="خلية"> الخلية</label><br>
      <label><input type="radio" name="q1" value="نسيج"> النسيج</label><br>
      <label><input type="radio" name="q1" value="عضو"> العضو</label>
    </div>

    <div class="question">
      <p>2. أي من التالي مسؤول عن ضخ الدم؟</p>
      <label><input type="radio" name="q2" value="قلب"> القلب</label><br>
      <label><input type="radio" name="q2" value="رئة"> الرئة</label><br>
      <label><input type="radio" name="q2" value="معدة"> المعدة</label>
    </div>

    <button id="finishBtn">تسليم الامتحان</button>
  </section>

  <!-- Section 3: Results -->
  <section id="resultsSection">
    <h2>النتيجة</h2>
    <p id="resultText"></p>
  </section>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbyBT2gZuYjTWJOpVAlYKBAK34jCkvYl0khIiBDlwis5BMSSHXecxzzHMwMu7v736uM/exec"; // ضع هنا رابط Google Apps Script
    let studentInfo = {};

    // ============ Step 1: Save Info & Move to Exam ============
    document.getElementById("studentForm").addEventListener("submit", e => {
      e.preventDefault();
      const formData = new FormData(e.target);
      studentInfo = Object.fromEntries(formData);

      // send basic info first
      fetch(scriptURL, { method: "POST", body: formData });

      showSection("examSection");
    });

    // ============ Step 2: Finish Exam ============
    document.getElementById("finishBtn").addEventListener("click", () => {
      let score = calculateScore();

      // show result
      document.getElementById("resultText").innerText = 
        "النتيجة: " + score + " من 2";

      // send info + score
      let formData = new FormData();
      for (let key in studentInfo) {
        formData.append(key, studentInfo[key]);
      }
      formData.append("score", score);

      fetch(scriptURL, { method: "POST", body: formData });

      showSection("resultsSection");
    });

    // ============ Score Calculation ============
    function calculateScore() {
      let score = 0;
      if (document.querySelector("input[name='q1']:checked")?.value === "خلية") score++;
      if (document.querySelector("input[name='q2']:checked")?.value === "قلب") score++;
      return score;
    }

    // ============ Show/Hide Sections ============
    function showSection(id) {
      document.querySelectorAll("section").forEach(sec => sec.classList.remove("active"));
      document.getElementById(id).classList.add("active");
    }
  </script>

</body>
</html>

